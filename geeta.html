<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gita for Kids - Learn & Play</title>

    <!-- OpenDyslexic Font for better readability -->
    <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-primary: #FFF8E7;
            --bg-secondary: #FFE4C4;
            --text-primary: #2D3436;
            --text-secondary: #636E72;
            --accent-blue: #74B9FF;
            --accent-green: #55EFC4;
            --accent-yellow: #FFEAA7;
            --accent-pink: #FD79A8;
            --accent-purple: #A29BFE;
            --accent-orange: #FAB1A0;
            --accent-red: #FF7675;
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
            --radius: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'OpenDyslexic', 'Comic Sans MS', cursive, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.8;
            letter-spacing: 0.05em;
            word-spacing: 0.1em;
        }

        /* Floating Background Shapes */
        .bg-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            animation: float 20s infinite ease-in-out;
        }

        .bg-shape:nth-child(1) {
            width: 300px;
            height: 300px;
            background: var(--accent-blue);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }

        .bg-shape:nth-child(2) {
            width: 200px;
            height: 200px;
            background: var(--accent-pink);
            top: 50%;
            right: -50px;
            animation-delay: -5s;
        }

        .bg-shape:nth-child(3) {
            width: 250px;
            height: 250px;
            background: var(--accent-green);
            bottom: -100px;
            left: 30%;
            animation-delay: -10s;
        }

        .bg-shape:nth-child(4) {
            width: 180px;
            height: 180px;
            background: var(--accent-yellow);
            top: 20%;
            left: 60%;
            animation-delay: -15s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-30px) rotate(5deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(30px) rotate(-5deg); }
        }

        /* Main Container */
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dynamic Navigation Bar */
        .nav-bar {
            position: sticky;
            top: 0;
            z-index: 500;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-link {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: white;
            color: var(--accent-blue);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
        }

        /* Camera Section */
        .camera-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .camera-container {
            flex: 1;
            min-width: 300px;
            position: relative;
            background: #000;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            display: none; /* main camera hidden, we use preview window */
        }

        /* Camera Preview - Fixed Position */
        .camera-preview {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 240px;
            height: 180px;
            border-radius: var(--radius);
            overflow: hidden;
            border: 4px solid var(--accent-blue);
            box-shadow: 0 0 30px rgba(116, 185, 255, 0.6);
            z-index: 100;
            background: #000;
        }

        .camera-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            display: block;
        }

        .camera-preview canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }

        .camera-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-weight: bold;
        }

        .status-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }

        .status-dot.active {
            background: #27ae60;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .hand-cursor {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            transition: transform 0.1s ease-out;
            display: none;
        }

        .hand-cursor.open {
            background: radial-gradient(circle, var(--accent-blue) 0%, transparent 70%);
            border: 4px solid var(--accent-blue);
            transform: scale(1);
        }

        .hand-cursor.closed {
            background: radial-gradient(circle, var(--accent-green) 0%, transparent 70%);
            border: 4px solid var(--accent-green);
            transform: scale(0.7);
        }

        /* Instructions Panel */
        .instructions-panel {
            flex: 0 0 auto;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 232, 196, 0.95) 100%);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            max-width: 380px;
        }

        .instructions-panel h3 {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .instructions-panel ul {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .instructions-panel li {
            padding: 10px 12px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            border-radius: 12px;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: white;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .instructions-panel li:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.5);
        }

        .instructions-panel li span {
            font-size: 1.8rem;
            display: block;
        }

        /* Game Area */
        .game-area {
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            min-height: 500px;
            box-shadow: var(--shadow);
            position: relative;
        }

        /* Mode Tabs: Study vs Quiz */
        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-family: inherit;
            background: white;
            color: var(--text-primary);
            border: 3px solid var(--text-secondary);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-btn:hover {
            transform: scale(1.05);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            color: white;
            border-color: var(--accent-blue);
        }

        .game-title {
            text-align: center;
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        /* Study Section */
        .study-intro {
            text-align: center;
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .study-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .study-card {
            background: linear-gradient(135deg, #ffffff 0%, #ffe9d6 100%);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .study-card::before {
            content: 'üïâÔ∏è';
            position: absolute;
            font-size: 3rem;
            right: 10px;
            top: 10px;
            opacity: 0.15;
        }

        .study-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 8px;
            background: var(--accent-yellow);
            color: var(--text-primary);
        }

        .study-title {
            font-size: 1.3rem;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .study-keyline {
            font-size: 0.95rem;
            color: var(--accent-purple);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .study-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .study-speak-btn {
            margin-top: 10px;
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            background: var(--accent-blue);
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: var(--shadow);
        }

        .study-speak-btn:hover {
            transform: translateY(-1px);
        }

        /* Quiz Section */
        .hint-btn {
            position: absolute;
            top: 20px;
            left: 30px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-family: inherit;
            background: var(--accent-orange);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .hint-btn:hover {
            transform: scale(1.05);
        }

        .score-display {
            position: absolute;
            top: 20px;
            right: 30px;
            background: var(--accent-yellow);
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: var(--shadow);
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green) 0%, var(--accent-blue) 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* Level Selection Styles */
        .level-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-family: inherit;
            background: white;
            color: var(--text-primary);
            border: 3px solid var(--text-secondary);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .level-btn:hover {
            transform: scale(1.05);
        }

        .level-btn.active {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            color: white;
            border-color: var(--accent-blue);
        }

        .level-btn.easy {
            border-color: var(--accent-green);
        }

        .level-btn.easy.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .level-btn.medium {
            border-color: var(--accent-yellow);
        }

        .level-btn.medium.active {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .level-btn.hard {
            border-color: var(--accent-red);
        }

        .level-btn.hard.active {
            background: var(--accent-red);
            border-color: var(--accent-red);
        }

        .level-btn.completed::after {
            content: ' ‚úì';
            font-size: 1.2rem;
        }

        /* Draggable Items / Drop Zones (Quiz) */
        .items-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .draggable-item {
            min-width: 90px;
            min-height: 90px;
            width: 140px;
            height: 100px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: grab;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            user-select: none;
            position: relative;
            flex-wrap: wrap;
            padding: 8px;
            word-break: break-word;
            overflow: hidden;
            text-align: center;
            line-height: 1.3;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            color: white;
        }

        .draggable-item:hover {
            transform: scale(1.05);
        }

        .draggable-item.dragging {
            opacity: 0.7;
            cursor: grabbing;
            z-index: 100;
            position: fixed;
            pointer-events: none;
        }

        .draggable-item.matched {
            opacity: 0.5;
            pointer-events: none;
        }

        .drop-zones {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .drop-zone {
            min-width: 160px;
            min-height: 120px;
            width: 250px;
            height: 150px;
            border: 4px dashed var(--text-secondary);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
            flex-wrap: wrap;
            padding: 10px;
            word-break: break-word;
            text-align: center;
            overflow: hidden;
            line-height: 1.3;
            background: #fffef7;
        }

        .drop-zone.highlight {
            border-color: var(--accent-blue);
            background: rgba(116, 185, 255, 0.15);
            transform: scale(1.02);
        }

        .drop-zone.correct {
            border-color: var(--accent-green);
            background: var(--accent-green);
            color: #2c3e50;
            animation: celebrate 0.5s ease;
        }

        .drop-zone.incorrect {
            border-color: var(--accent-red);
            background: rgba(255, 118, 117, 0.3);
            animation: shake 0.5s ease;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Feedback Messages */
        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px 50px;
            border-radius: var(--radius);
            font-size: 2rem;
            font-weight: bold;
            z-index: 1000;
            animation: popIn 0.5s ease;
            display: none;
        }

        .feedback-message.success {
            background: var(--accent-green);
            color: white;
        }

        .feedback-message.error {
            background: var(--accent-red);
            color: white;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Level Complete */
        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .level-complete-content {
            background: white;
            padding: 50px;
            border-radius: var(--radius);
            text-align: center;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0); }
        }

        .level-complete h2 {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .level-complete .stars {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .next-level-btn {
            padding: 20px 40px;
            font-size: 1.3rem;
            font-family: inherit;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
        }

        .next-level-btn:hover {
            transform: scale(1.05);
        }

        /* Sound Button */
        .sound-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-purple);
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sound-btn:hover {
            transform: scale(1.1);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall 3s linear infinite;
            z-index: 3000;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .game-content {
            display: none;
        }
        .game-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            .header p {
                font-size: 1rem;
            }
            .camera-section {
                flex-direction: column;
                gap: 15px;
            }
            .camera-preview {
                width: 180px;
                height: 135px;
                bottom: 90px;
                right: 15px;
            }
            .instructions-panel {
                max-width: 100%;
            }
            .draggable-item {
                width: 110px;
                height: 90px;
                font-size: 0.95rem;
            }
            .drop-zone {
                width: 220px;
                height: 140px;
                font-size: 0.9rem;
            }
            .game-area {
                padding: 20px;
                min-height: 450px;
            }
            .score-display {
                font-size: 1rem;
                padding: 10px 15px;
                top: 10px;
                right: 10px;
            }
            .hint-btn {
                font-size: 0.9rem;
                padding: 8px 15px;
                top: 10px;
                left: 10px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3rem;
            }
            .instructions-panel {
                padding: 15px;
                max-width: 100%;
            }
            .instructions-panel h3 {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            .instructions-panel ul {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .instructions-panel li {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
            .instructions-panel li span {
                font-size: 1.5rem;
            }
            .camera-preview {
                width: 140px;
                height: 105px;
                bottom: 80px;
                right: 10px;
                border: 3px solid var(--accent-blue);
            }
            .draggable-item {
                width: 100px;
                height: 80px;
                font-size: 0.9rem;
            }
            .drop-zone {
                width: 200px;
                height: 130px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Dynamic Navigation Bar -->
    <div class="nav-bar">
        <div class="nav-container">
            <div class="nav-title">üìú Gita for Kids</div>
            <div class="nav-menu" id="navMenu"></div>
        </div>
    </div>

    <!-- Background Shapes -->
    <div class="bg-shapes">
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
    </div>

    <!-- Hand Cursor -->
    <div class="hand-cursor" id="handCursor"></div>

    <!-- Feedback Message -->
    <div class="feedback-message" id="feedbackMessage"></div>

    <!-- Level Complete Modal -->
    <div class="level-complete" id="levelComplete">
        <div class="level-complete-content">
            <h2>üéâ Great Job! üéâ</h2>
            <div class="stars">‚≠ê‚≠ê‚≠ê</div>
            <p style="font-size: 1.3rem; margin-bottom: 20px;">You completed this level!</p>
            <button class="next-level-btn" onclick="nextLevel()">Next Level ‚Üí</button>
        </div>
    </div>

    <!-- Sound Toggle Button -->
    <button class="sound-btn" id="soundBtn" onclick="toggleSound()">üîä</button>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üïâÔ∏è Learn Bhagavad Gita with Your Hands üñêÔ∏è</h1>
            <p>First read simple stories. Then play a matching quiz using your hand movements or mouse.</p>
        </header>

        <!-- Camera Section -->
        <section class="camera-section">
            <div class="camera-container">
                <video id="videoElement" autoplay playsinline></video>
                <canvas id="canvasOverlay"></canvas>
            </div>
            <div class="instructions-panel">
                <h3>üìã How to Use Your Hand</h3>
                <ul>
                    <li><span>‚úã</span> Show Hand</li>
                    <li><span>üëÜ</span> Move Pointer</li>
                    <li><span>ü§è</span> Pinch to Grab</li>
                    <li><span>üéØ</span> Drop on Answer</li>
                    <li><span>üîä</span> Tap to Hear</li>
                    <li><span>‚≠ê</span> Finish Level</li>
                </ul>
                <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                    Tip: Press <strong>M</strong> on your keyboard to switch to mouse mode if the camera is off.
                </p>
            </div>
        </section>

        <!-- Camera Preview -->
        <div class="camera-preview" id="cameraPreview">
            <video id="previewVideoElement" autoplay playsinline></video>
            <canvas id="previewCanvasOverlay"></canvas>
            <div class="camera-status">
                <div class="status-dot" id="cameraStatusDot"></div>
                <span>Camera</span>
            </div>
        </div>

        <!-- Study & Quiz Area -->
        <section class="game-area" id="gameArea">
            <!-- Mode Tabs -->
            <div class="mode-tabs">
                <button class="mode-btn active" id="studyModeBtn" onclick="showMode('study')">üìñ Study</button>
                <button class="mode-btn" id="quizModeBtn" onclick="showMode('quiz')">üéÆ Quiz</button>
            </div>

            <!-- STUDY MODE -->
            <div class="game-content active" id="studyMode">
                <h2 class="game-title">üìñ Study: Simple Gita Stories & Ideas</h2>
                <p class="study-intro">
                    These cards tell the main ideas of the Bhagavad Gita in kid-friendly language:
                    courage, calm mind, doing your duty, and kindness.
                    Click the üîä button on any card to hear it.
                </p>
                <div class="study-grid" id="studyGrid">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- QUIZ MODE -->
            <div class="game-content" id="quizMode">
                <button class="hint-btn" onclick="giveHint()">üí° Hint</button>
                <div class="score-display">‚≠ê Score: <span id="scoreValue">0</span></div>

                <h2 class="game-title">üéÆ Quiz: Match the Question with the Right Answer</h2>

                <div class="level-selector">
                    <button class="level-btn easy active" onclick="selectLevel('easy')">üü¢ Easy</button>
                    <button class="level-btn medium" onclick="selectLevel('medium')">üü° Medium</button>
                    <button class="level-btn hard" onclick="selectLevel('hard')">üî¥ Hard</button>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="quizProgressBar"></div>
                </div>

                <div style="text-align:center; font-size:0.95rem; color:var(--text-secondary); margin-bottom:10px;">
                    Drag an answer tile and drop it on the matching question. You can also click any tile or question to hear it.
                </div>

                <div class="items-container" id="quizAnswers"></div>
                <div class="drop-zones" id="quizQuestions"></div>
            </div>
        </section>
    </div>

    <script>
        // ==================== SIMPLE NAV (OPTIONAL MULTI-PAGE) ====================
        const GAMES_CONFIG = {
            'gita_kids.html': { name: 'üìú Gita for Kids', description: 'Study + Quiz game with hand control' }
        };

        function initializeNavigation() {
            const navMenu = document.getElementById('navMenu');
            const currentFile = window.location.pathname.split('/').pop() || 'gita_kids.html';

            navMenu.innerHTML = '';

            for (const [file, config] of Object.entries(GAMES_CONFIG)) {
                const link = document.createElement('a');
                link.className = 'nav-link';
                link.href = file;
                link.textContent = config.name;
                link.title = config.description;

                if (currentFile === file) {
                    link.classList.add('active');
                }
                navMenu.appendChild(link);
            }
        }

        // ==================== CONFIG & STATE ====================
        const CONFIG = {
            pinchThreshold: 0.08,
            smoothingFactor: 0.3,
            soundEnabled: true
        };

        let currentLevel = 'easy';
        let score = 0;
        let matchesCompleted = 0;
        let totalMatches = 0;
        let draggedItem = null;
        let isDragging = false;
        let handPosition = { x: 0, y: 0 };
        let isPinching = false;
        let previousPinchState = false;

        let levelsCompleted = {
            easy: false,
            medium: false,
            hard: false
        };

        // ==================== AUDIO SYSTEM ====================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        function playTone(frequency, duration = 0.3, type = 'sine') {
            if (!CONFIG.soundEnabled || !audioCtx) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = type;

            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration);
        }

        function playSuccessSound() {
            playTone(523.25, 0.15); // C5
            setTimeout(() => playTone(659.25, 0.15), 100);
            setTimeout(() => playTone(783.99, 0.3), 200);
        }

        function playErrorSound() {
            playTone(200, 0.3, 'square');
        }

        function playPickupSound() {
            playTone(400, 0.1);
        }

        function playDropSound() {
            playTone(300, 0.1);
        }

        function speak(text, rate = 0.9) {
            if (!CONFIG.soundEnabled) return;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = rate;
            utterance.pitch = 1.1;
            utterance.lang = 'en-IN';
            speechSynthesis.speak(utterance);
        }

        function toggleSound() {
            CONFIG.soundEnabled = !CONFIG.soundEnabled;
            document.getElementById('soundBtn').textContent = CONFIG.soundEnabled ? 'üîä' : 'üîá';
        }

        // ==================== STUDY CONTENT ====================
        const studyCards = [
            {
                tag: 'Characters',
                title: 'Arjuna & Krishna',
                keyLine: 'A friend who guides us.',
                text: 'Arjuna is a brave prince, but before a big battle he feels scared and confused. Krishna becomes his charioteer and wise guide. When we are confused, we can ask a calm and loving person for help.',
            },
            {
                tag: 'Calm Mind',
                title: 'Calm Like a Lake',
                keyLine: 'Think clearly, act wisely.',
                text: 'Krishna tells Arjuna that a quiet mind is like still water. When our thoughts are too noisy, we cannot see clearly. Taking deep breaths and pausing helps us choose better actions.',
            },
            {
                tag: 'Karma Yoga',
                title: 'Do Your Best, Forget the Rest',
                keyLine: 'Do your duty, not for reward.',
                text: 'Gita teaches us to focus on our effort, not on prizes or fear of failure. We study, help at home, and be kind because it is right, not only for marks or gifts.',
            },
            {
                tag: 'Courage',
                title: 'Facing Big Feelings',
                keyLine: 'Brave does not mean no fear.',
                text: 'Arjuna admits that he is afraid. Krishna does not laugh at him. He explains things slowly. Being brave means we tell the truth about our feelings and still try to do the right thing.',
            },
            {
                tag: 'Kindness',
                title: 'See the Same Light in All',
                keyLine: 'Respect every living being.',
                text: 'Gita says a wise person sees the same inner light in everyone ‚Äî in friends, strangers, rich, poor, animals, and plants. This teaches us not to bully others and to care for nature.',
            },
            {
                tag: 'Practice',
                title: 'Small Steps Every Day',
                keyLine: 'Mind is a little monkey.',
                text: 'The mind jumps here and there like a monkey. Krishna says it can be trained by gentle practice. Reading, breathing, saying thank you, and helping a little every day makes the mind stronger and kinder.',
            },
            {
                tag: 'Self-Control',
                title: 'Driver of Your Chariot',
                keyLine: 'You can guide your senses.',
                text: 'The body is like a chariot, the senses are horses, and the mind holds the reins. When we guide our senses ‚Äî like not shouting when angry or not eating too much junk ‚Äî we drive our chariot in a safe direction.',
            },
            {
                tag: 'Hope',
                title: 'Never Too Late to Learn',
                keyLine: 'Every moment is a new start.',
                text: 'Krishna tells Arjuna that even if we made mistakes before, we can start learning and changing now. Every new day and every small good choice has value.',
            }
        ];

        // ==================== QUIZ DATA ====================
        const quizData = {
            easy: [
                {
                    id: 'Q1',
                    question: 'Who is the prince who feels confused and scared before the battle?',
                    answer: 'Arjuna'
                },
                {
                    id: 'Q2',
                    question: 'Who is Arjuna‚Äôs friend and charioteer who explains the Gita?',
                    answer: 'Krishna'
                },
                {
                    id: 'Q3',
                    question: 'Gita says: we should focus on doing our ______, not on the result.',
                    answer: 'Duty'
                },
                {
                    id: 'Q4',
                    question: 'What kind of mind helps us see clearly, like still water?',
                    answer: 'Calm mind'
                },
                {
                    id: 'Q5',
                    question: 'When we feel confused, what should we do?',
                    answer: 'Ask a wise person for help'
                },
                {
                    id: 'Q6',
                    question: 'Being brave means we feel fear but still try to do the ______ thing.',
                    answer: 'Right'
                }
            ],
            medium: [
                {
                    id: 'Q7',
                    question: '‚ÄúDo your best and leave the rest‚Äù is a kid-friendly way to remember which Gita idea?',
                    answer: 'Karma Yoga'
                },
                {
                    id: 'Q8',
                    question: 'Gita says a wise person sees the same inner light in ______.',
                    answer: 'Everyone'
                },
                {
                    id: 'Q9',
                    question: 'If the mind is like a monkey, what helps to train it?',
                    answer: 'Practice every day'
                },
                {
                    id: 'Q10',
                    question: 'What should we avoid if we want a calm mind?',
                    answer: 'Too much anger and worry'
                },
                {
                    id: 'Q11',
                    question: 'How can we show that we see the same light in all beings?',
                    answer: 'By being kind to everyone'
                },
                {
                    id: 'Q12',
                    question: 'What does Krishna do when Arjuna says ‚ÄúI am confused‚Äù?',
                    answer: 'He explains calmly'
                }
            ],
            hard: [
                {
                    id: 'Q13',
                    question: 'In the chariot example, the body is the chariot. What are the horses?',
                    answer: 'The senses'
                },
                {
                    id: 'Q14',
                    question: 'What holds the reins of the horses (senses) in the Gita‚Äôs chariot picture?',
                    answer: 'The mind'
                },
                {
                    id: 'Q15',
                    question: 'If someone studies only for marks and prizes, what does Gita gently remind them?',
                    answer: 'Do it because it is right'
                },
                {
                    id: 'Q16',
                    question: 'Gita teaches that even after many mistakes, what can we always do?',
                    answer: 'Start again with good actions'
                },
                {
                    id: 'Q17',
                    question: 'What can we do when we feel anger building up inside?',
                    answer: 'Pause and take deep breaths'
                },
                {
                    id: 'Q18',
                    question: 'Seeing the same light in all helps us to stop which harmful habit?',
                    answer: 'Bullying or looking down on others'
                },
                {
                    id: 'Q19',
                    question: 'Krishna speaks to Arjuna in the middle of a battle field. What does this teach about where we can learn?',
                    answer: 'We can learn even in tough times'
                },
                {
                    id: 'Q20',
                    question: 'Following Gita, when we help at home, we should do it with a ______ attitude.',
                    answer: 'Happy and willing'
                }
            ]
        };

        // ==================== MEDIAPIPE SETUP ====================
        const videoElement = document.getElementById('previewVideoElement');
        const canvasElement = document.getElementById('previewCanvasOverlay');
        const canvasCtx = canvasElement.getContext('2d');
        const handCursor = document.getElementById('handCursor');
        const cameraStatusDot = document.getElementById('cameraStatusDot');

        const holistic = new Holistic({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;
            }
        });

        holistic.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            enableSegmentation: false,
            smoothSegmentation: false,
            refineFaceLandmarks: false,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        holistic.onResults(onResults);

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: 640,
                        height: 480,
                        facingMode: 'user'
                    }
                });
                videoElement.srcObject = stream;

                videoElement.onloadedmetadata = () => {
                    canvasElement.width = videoElement.videoWidth || 640;
                    canvasElement.height = videoElement.videoHeight || 480;
                    cameraStatusDot.classList.add('active');
                    detectLoop();
                };
            } catch (err) {
                console.error('Camera error:', err);
                cameraStatusDot.classList.remove('active');
            }
        }

        async function detectLoop() {
            if (videoElement.readyState >= 2) {
                await holistic.send({ image: videoElement });
            }
            requestAnimationFrame(detectLoop);
        }

        function onResults(results) {
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

            if (results.rightHandLandmarks) {
                drawConnectors(canvasCtx, results.rightHandLandmarks, HAND_CONNECTIONS, {
                    color: '#74B9FF',
                    lineWidth: 3
                });
                drawLandmarks(canvasCtx, results.rightHandLandmarks, {
                    color: '#55EFC4',
                    lineWidth: 2,
                    radius: 5
                });
                processHand(results.rightHandLandmarks);
            } else if (results.leftHandLandmarks) {
                drawConnectors(canvasCtx, results.leftHandLandmarks, HAND_CONNECTIONS, {
                    color: '#74B9FF',
                    lineWidth: 3
                });
                drawLandmarks(canvasCtx, results.leftHandLandmarks, {
                    color: '#55EFC4',
                    lineWidth: 2,
                    radius: 5
                });
                processHand(results.leftHandLandmarks);
            } else {
                handCursor.style.display = 'none';
            }
        }

        function processHand(landmarks) {
            const indexTip = landmarks[8];
            const thumbTip = landmarks[4];

            const rawX = (1 - indexTip.x) * window.innerWidth;
            const rawY = indexTip.y * window.innerHeight;

            handPosition.x = handPosition.x + (rawX - handPosition.x) * CONFIG.smoothingFactor;
            handPosition.y = handPosition.y + (rawY - handPosition.y) * CONFIG.smoothingFactor;

            handCursor.style.display = 'block';
            handCursor.style.left = (handPosition.x - 30) + 'px';
            handCursor.style.top = (handPosition.y - 30) + 'px';

            const pinchDistance = Math.sqrt(
                Math.pow(indexTip.x - thumbTip.x, 2) +
                Math.pow(indexTip.y - thumbTip.y, 2) +
                Math.pow(indexTip.z - thumbTip.z, 2)
            );

            isPinching = pinchDistance < CONFIG.pinchThreshold;

            if (isPinching) {
                handCursor.classList.remove('open');
                handCursor.classList.add('closed');
            } else {
                handCursor.classList.remove('closed');
                handCursor.classList.add('open');
            }

            handleDragDrop();
            previousPinchState = isPinching;
        }

        const HAND_CONNECTIONS = [
            [0, 1], [1, 2], [2, 3], [3, 4],
            [0, 5], [5, 6], [6, 7], [7, 8],
            [0, 9], [9, 10], [10, 11], [11, 12],
            [0, 13], [13, 14], [14, 15], [15, 16],
            [0, 17], [17, 18], [18, 19], [19, 20],
            [5, 9], [9, 13], [13, 17]
        ];

        // ==================== DRAG & DROP ====================
        function handleDragDrop() {
            const elementsAtPoint = document.elementsFromPoint(handPosition.x, handPosition.y);

            if (isPinching && !previousPinchState && !isDragging) {
                for (const el of elementsAtPoint) {
                    if (el.classList && el.classList.contains('draggable-item') && !el.classList.contains('matched')) {
                        startDrag(el);
                        break;
                    }
                }
            }

            if (isDragging && draggedItem) {
                draggedItem.style.left = (handPosition.x - 60) + 'px';
                draggedItem.style.top = (handPosition.y - 60) + 'px';
                highlightDropZones(elementsAtPoint);
            }

            if (!isPinching && previousPinchState && isDragging) {
                endDrag(elementsAtPoint);
            }
        }

        function startDrag(element) {
            isDragging = true;
            draggedItem = element;
            draggedItem.classList.add('dragging');
            playPickupSound();
            initAudio();

            const valueToSpeak = draggedItem.dataset.value;
            if (valueToSpeak) {
                speak(valueToSpeak);
            }
        }

        function highlightDropZones(elements) {
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('highlight');
            });

            for (const el of elements) {
                if (el.classList && el.classList.contains('drop-zone') && !el.classList.contains('correct')) {
                    el.classList.add('highlight');
                    break;
                }
            }
        }

        function endDrag(elements) {
            if (!draggedItem) return;
            playDropSound();

            let dropped = false;

            for (const el of elements) {
                if (el.classList && el.classList.contains('drop-zone') && !el.classList.contains('correct')) {
                    const dragValue = draggedItem.dataset.match;
                    const dropValue = el.dataset.match;

                    if (dragValue === dropValue) {
                        handleCorrectMatch(el);
                    } else {
                        handleWrongMatch(el);
                    }
                    dropped = true;
                    break;
                }
            }

            if (!dropped || !draggedItem.classList.contains('matched')) {
                draggedItem.classList.remove('dragging');
                draggedItem.style.position = '';
                draggedItem.style.left = '';
                draggedItem.style.top = '';
            }

            isDragging = false;
            draggedItem = null;
        }

        function handleCorrectMatch(dropZone) {
            playSuccessSound();
            speak('Great job!', 1);

            showFeedback('üéâ Correct!', 'success');

            dropZone.classList.add('correct');
            dropZone.querySelector('.question-text') &&
                (dropZone.querySelector('.question-text').style.fontWeight = 'bold');

            dropZone.innerHTML =
                '<div style="font-size:0.9rem;margin-bottom:6px;">' +
                dropZone.dataset.questionText +
                '</div><div style="font-size:1rem;font-weight:bold;margin-top:4px;">' +
                draggedItem.dataset.value +
                '</div>';

            draggedItem.classList.add('matched');
            draggedItem.classList.remove('dragging');
            draggedItem.style.display = 'none';

            score += 10;
            matchesCompleted++;
            updateScore();
            updateProgress();

            if (matchesCompleted >= totalMatches) {
                setTimeout(() => showLevelComplete(), 700);
            }
        }

        function handleWrongMatch(dropZone) {
            playErrorSound();
            speak('Try again.', 1);
            showFeedback('‚ùå Try Again!', 'error');

            dropZone.classList.add('incorrect');
            setTimeout(() => {
                dropZone.classList.remove('incorrect');
            }, 500);

            draggedItem.classList.remove('dragging');
            draggedItem.style.position = '';
            draggedItem.style.left = '';
            draggedItem.style.top = '';
        }

        function showFeedback(message, type) {
            const feedbackEl = document.getElementById('feedbackMessage');
            feedbackEl.textContent = message;
            feedbackEl.className = 'feedback-message ' + type;
            feedbackEl.style.display = 'block';

            setTimeout(() => {
                feedbackEl.style.display = 'none';
            }, 1200);
        }

        function updateScore() {
            document.getElementById('scoreValue').textContent = score;
        }

        function updateProgress() {
            const bar = document.getElementById('quizProgressBar');
            const progress = totalMatches === 0 ? 0 : (matchesCompleted / totalMatches) * 100;
            bar.style.width = progress + '%';
        }

        function showLevelComplete() {
            levelsCompleted[currentLevel] = true;
            updateLevelButtons();

            const levelCompleteEl = document.getElementById('levelComplete');
            const levelCompleteContent = levelCompleteEl.querySelector('.level-complete-content');

            let nextText = '';
            if (currentLevel === 'easy') nextText = 'Go to Medium Level ‚Üí';
            else if (currentLevel === 'medium') nextText = 'Go to Hard Level ‚Üí';
            else nextText = 'Play Again from Easy ‚Üí';

            levelCompleteContent.innerHTML = `
                <h2>üéâ Well Done! üéâ</h2>
                <div class="stars">‚≠ê‚≠ê‚≠ê</div>
                <p style="font-size:1.3rem;margin-bottom:20px;">
                    You finished the ${currentLevel.toUpperCase()} quiz for Gita values!
                </p>
                <button class="next-level-btn" onclick="nextLevel()">${nextText}</button>
            `;

            levelCompleteEl.style.display = 'flex';
            createConfetti();
            playSuccessSound();
            speak('Congratulations! You completed this level.', 0.9);
        }

        function createConfetti() {
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e91e63'];

            for (let i = 0; i < 45; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 5000);
            }
        }

        // ==================== QUIZ SETUP ====================
        function selectLevel(level) {
            currentLevel = level;
            matchesCompleted = 0;
            updateProgress();

            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.level-btn.' + level).classList.add('active');

            setupQuizGame(level);
        }

        function updateLevelButtons() {
            document.querySelectorAll('.level-btn').forEach(btn => {
                let level = 'easy';
                if (btn.classList.contains('medium')) level = 'medium';
                else if (btn.classList.contains('hard')) level = 'hard';

                if (levelsCompleted[level]) {
                    btn.classList.add('completed');
                } else {
                    btn.classList.remove('completed');
                }
            });
        }

        function setupQuizGame(level) {
            const answersContainer = document.getElementById('quizAnswers');
            const questionsContainer = document.getElementById('quizQuestions');
            answersContainer.innerHTML = '';
            questionsContainer.innerHTML = '';

            const data = quizData[level];
            if (!data) return;

            let itemCount = 4;
            if (level === 'medium') itemCount = 6;
            if (level === 'hard') itemCount = 8;

            const questions = shuffle([...data]).slice(0, Math.min(itemCount, data.length));
            totalMatches = questions.length;
            matchesCompleted = 0;
            updateProgress();

            // Create question drop zones
            questions.forEach(q => {
                const zone = document.createElement('div');
                zone.className = 'drop-zone';
                zone.dataset.match = q.id;
                zone.dataset.questionText = q.question;
                zone.innerHTML = `<div class="question-text" style="font-size:0.95rem;margin-bottom:6px;">${q.question}</div>`;
                zone.onclick = () => {
                    initAudio();
                    speak(q.question, 0.95);
                };
                questionsContainer.appendChild(zone);
            });

            // Create answer tiles, shuffled separately
            shuffle([...questions]).forEach(q => {
                const item = document.createElement('div');
                item.className = 'draggable-item';
                item.dataset.match = q.id;
                item.dataset.value = q.answer;
                item.textContent = q.answer;
                item.onclick = () => {
                    initAudio();
                    speak(q.answer, 0.95);
                };
                answersContainer.appendChild(item);
            });
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function nextLevel() {
            document.getElementById('levelComplete').style.display = 'none';
            if (currentLevel === 'easy') {
                selectLevel('medium');
            } else if (currentLevel === 'medium') {
                selectLevel('hard');
            } else {
                selectLevel('easy');
            }
        }

        function giveHint() {
            const items = document.querySelectorAll('.draggable-item:not(.matched)');
            if (items.length === 0) return;

            const item = items[0];
            const matchValue = item.dataset.match;
            const targetZone = document.querySelector(`.drop-zone[data-match="${matchValue}"]:not(.correct)`);

            if (targetZone) {
                item.style.animation = 'celebrate 0.5s ease 3';
                targetZone.style.animation = 'celebrate 0.5s ease 3';
                setTimeout(() => {
                    item.style.animation = '';
                    targetZone.style.animation = '';
                }, 1500);

                speak('Try matching: ' + item.dataset.value, 0.9);
            }
        }

        // ==================== STUDY SETUP ====================
        function setupStudyCards() {
            const grid = document.getElementById('studyGrid');
            grid.innerHTML = '';

            studyCards.forEach(card => {
                const div = document.createElement('div');
                div.className = 'study-card';
                div.innerHTML = `
                    <div class="study-tag">${card.tag}</div>
                    <div class="study-title">${card.title}</div>
                    <div class="study-keyline">${card.keyLine}</div>
                    <div class="study-text">${card.text}</div>
                    <button class="study-speak-btn">üîä Listen</button>
                `;
                const btn = div.querySelector('.study-speak-btn');
                btn.addEventListener('click', () => {
                    initAudio();
                    speak(card.title + '. ' + card.text, 0.95);
                });
                grid.appendChild(div);
            });
        }

        // ==================== MODE SWITCH ====================
        function showMode(mode) {
            const studyContent = document.getElementById('studyMode');
            const quizContent = document.getElementById('quizMode');
            const studyBtn = document.getElementById('studyModeBtn');
            const quizBtn = document.getElementById('quizModeBtn');

            if (mode === 'study') {
                studyContent.classList.add('active');
                quizContent.classList.remove('active');
                studyBtn.classList.add('active');
                quizBtn.classList.remove('active');
            } else {
                studyContent.classList.remove('active');
                quizContent.classList.add('active');
                studyBtn.classList.remove('active');
                quizBtn.classList.add('active');
            }
        }

        // ==================== MOUSE FALLBACK ====================
        let mouseMode = false;

        document.addEventListener('keydown', (e) => {
            if (e.key === 'm' || e.key === 'M') {
                mouseMode = !mouseMode;
                alert('Mouse mode: ' + (mouseMode ? 'ON' : 'OFF'));
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!mouseMode) return;

            handPosition.x = e.clientX;
            handPosition.y = e.clientY;

            handCursor.style.display = 'block';
            handCursor.style.left = (handPosition.x - 30) + 'px';
            handCursor.style.top = (handPosition.y - 30) + 'px';

            if (isDragging && draggedItem) {
                draggedItem.style.left = (handPosition.x - 60) + 'px';
                draggedItem.style.top = (handPosition.y - 60) + 'px';
                highlightDropZones(document.elementsFromPoint(handPosition.x, handPosition.y));
            }
        });

        document.addEventListener('mousedown', (e) => {
            if (!mouseMode) return;
            isPinching = true;
            previousPinchState = false;

            handCursor.classList.remove('open');
            handCursor.classList.add('closed');

            handleDragDrop();
            previousPinchState = true;
        });

        document.addEventListener('mouseup', (e) => {
            if (!mouseMode) return;
            isPinching = false;

            handCursor.classList.remove('closed');
            handCursor.classList.add('open');

            if (isDragging) {
                endDrag(document.elementsFromPoint(handPosition.x, handPosition.y));
            }
        });

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initializeNavigation();
            setupCamera();
            setupStudyCards();
            setupQuizGame('easy');
            updateLevelButtons();
            updateScore();

            document.addEventListener('click', () => {
                initAudio();
            });
        });
    </script>
</body>
</html>
