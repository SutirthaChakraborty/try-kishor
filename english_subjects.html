<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ English Quest - Words & Language Adventure!</title>

    <!-- Fonts -->
    <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&family=Patrick+Hand&display=swap" rel="stylesheet">

    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-primary: #2d1b4e;
            --bg-secondary: #1a0f2e;
            --bg-card: #3d2a5f;
            --accent-primary: #ff6b9d;
            --accent-secondary: #c44dff;
            --accent-yellow: #ffd93d;
            --accent-green: #6bff8c;
            --accent-blue: #4dc3ff;
            --accent-orange: #ff9f43;
            --text-primary: #ffffff;
            --text-secondary: #c9b8e0;
            --glow: 0 0 30px rgba(255, 107, 157, 0.4);
            --shadow: 0 10px 40px rgba(0,0,0,0.5);
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Baloo 2', 'OpenDyslexic', cursive;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* Book Pages Background */
        .book-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
            opacity: 0.1;
        }

        .floating-letter {
            position: absolute;
            font-family: 'Patrick Hand', cursive;
            font-size: 4rem;
            animation: floatLetter 20s infinite ease-in-out;
        }

        @keyframes floatLetter {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-40px) rotate(10deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(40px) rotate(-10deg); }
        }

        /* Home Button */
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
        }

        .home-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .home-button:active {
            transform: translateY(-1px);
        }

        /* Main Container */
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 3px solid var(--accent-primary);
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-yellow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.3rem;
            color: var(--text-secondary);
        }

        /* Topic Selection */
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .topic-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
            box-shadow: var(--glow);
        }

        .topic-card.active {
            border-color: var(--accent-yellow);
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 217, 61, 0.2) 100%);
        }

        .topic-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }

        .topic-card h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .mode-tab {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            background: var(--bg-card);
            color: var(--text-primary);
            border: 3px solid var(--accent-secondary);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .mode-tab:hover { transform: scale(1.05); }

        .mode-tab.active {
            background: var(--accent-secondary);
            color: white;
        }

        /* Game Area */
        .game-area {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 40px;
            min-height: 500px;
            box-shadow: var(--shadow);
            position: relative;
            border: 2px solid var(--accent-secondary);
        }

        /* Stats */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            background: var(--bg-secondary);
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            border: 2px solid var(--accent-yellow);
        }

        .stat span { color: var(--accent-yellow); }

        /* Progress */
        .progress-wrap {
            width: 100%;
            height: 12px;
            background: var(--bg-primary);
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-yellow) 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Learn Section */
        .learn-container { display: none; }
        .learn-container.active { display: block; }

        .learn-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            border: 3px solid var(--accent-primary);
        }

        .learn-word {
            font-size: 4rem;
            font-weight: 800;
            color: var(--accent-yellow);
            margin-bottom: 20px;
            font-family: 'Patrick Hand', cursive;
        }

        .learn-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 15px;
        }

        .learn-text {
            font-size: 1.3rem;
            color: var(--text-secondary);
            line-height: 1.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .example-box {
            background: var(--bg-primary);
            padding: 20px 30px;
            border-radius: 15px;
            margin-top: 25px;
            border-left: 5px solid var(--accent-green);
        }

        .example-label {
            color: var(--accent-green);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .nav-btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .nav-btn.prev {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--accent-secondary);
        }

        .nav-btn.next {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
        }

        .nav-btn:hover { transform: scale(1.05); }

        /* Quiz Section */
        .quiz-container { display: none; }
        .quiz-container.active { display: block; }

        .question-box {
            text-align: center;
            margin-bottom: 40px;
        }

        .q-number {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .q-text {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 20px;
        }

        .q-visual {
            font-size: 4rem;
            margin: 20px 0;
        }

        .q-word {
            font-size: 3rem;
            font-weight: 800;
            color: var(--accent-yellow);
            font-family: 'Patrick Hand', cursive;
            background: var(--bg-secondary);
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
            margin: 15px 0;
        }

        /* Answer Options */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .option-btn {
            padding: 25px;
            font-size: 1.3rem;
            font-weight: 600;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 3px solid var(--accent-blue);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .option-btn:hover {
            transform: scale(1.03);
            border-color: var(--accent-primary);
            box-shadow: var(--glow);
        }

        .option-btn.correct {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--bg-primary);
        }

        .option-btn.wrong {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .option-btn.highlight {
            border-color: var(--accent-primary);
            box-shadow: 0 0 25px var(--accent-primary);
            transform: scale(1.03);
        }

        /* Spelling Input */
        .spelling-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .letter-slot {
            width: 60px;
            height: 70px;
            background: var(--bg-secondary);
            border: 3px solid var(--accent-blue);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent-yellow);
            font-family: 'Patrick Hand', cursive;
        }

        .letter-slot.filled {
            border-color: var(--accent-green);
            background: rgba(107, 255, 140, 0.2);
        }

        .letter-choices {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .letter-btn {
            width: 55px;
            height: 55px;
            background: var(--bg-card);
            border: 3px solid var(--accent-secondary);
            border-radius: 10px;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Patrick Hand', cursive;
        }

        .letter-btn:hover {
            transform: scale(1.1);
            border-color: var(--accent-primary);
        }

        .letter-btn.used {
            opacity: 0.3;
            pointer-events: none;
        }

        /* Camera Preview */
        .camera-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 15px;
            overflow: hidden;
            border: 4px solid var(--accent-primary);
            box-shadow: var(--glow);
            z-index: 100;
            background: #000;
        }

        .camera-box video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .camera-box canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }

        .cam-status {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.7rem;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .cam-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-orange);
        }

        .cam-dot.on {
            background: var(--accent-green);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* Hand Pointer */
        .hand-pointer {
            position: fixed;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            display: none;
            transition: all 0.1s ease-out;
        }

        .hand-pointer.open {
            background: radial-gradient(circle, var(--accent-primary) 0%, transparent 70%);
            border: 3px solid var(--accent-primary);
        }

        .hand-pointer.closed {
            background: radial-gradient(circle, var(--accent-yellow) 0%, transparent 70%);
            border: 3px solid var(--accent-yellow);
            transform: scale(0.7);
        }

        /* Feedback */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            padding: 30px 50px;
            border-radius: var(--radius);
            font-size: 2.5rem;
            font-weight: 800;
            z-index: 2000;
        }

        .feedback.show {
            animation: popIn 0.5s ease forwards;
        }

        .feedback.success {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .feedback.error {
            background: var(--accent-orange);
            color: white;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Results Modal */
        .results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .results-content {
            background: var(--bg-card);
            padding: 50px;
            border-radius: var(--radius);
            text-align: center;
            border: 4px solid var(--accent-primary);
            box-shadow: 0 0 50px var(--accent-primary);
        }

        .results-content h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-primary);
        }

        .results-stars {
            font-size: 4rem;
            margin: 20px 0;
        }

        .results-score {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .play-again-btn {
            padding: 20px 50px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .play-again-btn:hover { transform: scale(1.1); }

        /* Sound Button */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-secondary);
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sound-toggle:hover { transform: scale(1.1); }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .q-text { font-size: 1.5rem; }
            .options-grid { grid-template-columns: 1fr; }
            .option-btn { padding: 20px; font-size: 1.1rem; }
            .camera-box { width: 150px; height: 112px; }
            .game-area { padding: 20px; }
            .letter-slot { width: 45px; height: 55px; font-size: 1.5rem; }
            .letter-btn { width: 45px; height: 45px; font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Book Background -->
    <div class="book-bg" id="bookBg"></div>

    <!-- Home Button -->
    <a href="index.html" class="home-button">
        üè† Home
    </a>

    <!-- Hand Pointer -->
    <div class="hand-pointer" id="handPointer"></div>

    <!-- Feedback -->
    <div class="feedback" id="feedback"></div>

    <!-- Results Modal -->
    <div class="results-modal" id="resultsModal">
        <div class="results-content">
            <h2>üéâ Fantastic Work! üéâ</h2>
            <div class="results-stars" id="resultsStars">‚≠ê‚≠ê‚≠ê</div>
            <p class="results-score" id="resultsScore"></p>
            <button class="play-again-btn" onclick="restartQuiz()">Play Again! üöÄ</button>
        </div>
    </div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>

    <!-- Camera Preview -->
    <div class="camera-box">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <div class="cam-status">
            <div class="cam-dot" id="camDot"></div>
            <span>Camera</span>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üìñ English Quest üåü</h1>
            <p>Master words, spelling, and grammar!</p>
        </header>

        <!-- Topic Selection -->
        <section class="topic-grid">
            <div class="topic-card active" data-topic="vocabulary" onclick="selectTopic('vocabulary')">
                <div class="topic-icon">üìö</div>
                <h3>Vocabulary</h3>
            </div>
            <div class="topic-card" data-topic="spelling" onclick="selectTopic('spelling')">
                <div class="topic-icon">‚úèÔ∏è</div>
                <h3>Spelling</h3>
            </div>
            <div class="topic-card" data-topic="grammar" onclick="selectTopic('grammar')">
                <div class="topic-icon">üìù</div>
                <h3>Grammar</h3>
            </div>
            <div class="topic-card" data-topic="opposites" onclick="selectTopic('opposites')">
                <div class="topic-icon">‚ÜîÔ∏è</div>
                <h3>Opposites</h3>
            </div>
            <div class="topic-card" data-topic="rhymes" onclick="selectTopic('rhymes')">
                <div class="topic-icon">üéµ</div>
                <h3>Rhyming</h3>
            </div>
        </section>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="mode-tab active" onclick="setMode('learn')">üìö Learn</button>
            <button class="mode-tab" onclick="setMode('quiz')">üéØ Quiz</button>
        </div>

        <!-- Game Area -->
        <section class="game-area">
            <!-- Stats -->
            <div class="stats-bar">
                <div class="stat">‚≠ê Score: <span id="score">0</span></div>
                <div class="stat">üî• Streak: <span id="streak">0</span></div>
                <div class="stat">‚ù§Ô∏è Lives: <span id="lives">3</span></div>
            </div>

            <!-- Progress -->
            <div class="progress-wrap">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>

            <!-- Learn Container -->
            <div class="learn-container active" id="learnContainer">
                <div class="learn-card" id="learnCard">
                    <!-- Content loaded by JS -->
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn prev" onclick="prevLesson()">‚Üê Back</button>
                    <button class="nav-btn next" onclick="nextLesson()">Next ‚Üí</button>
                </div>
            </div>

            <!-- Quiz Container -->
            <div class="quiz-container" id="quizContainer">
                <div class="question-box" id="questionBox">
                    <p class="q-number" id="qNumber">Question 1 of 10</p>
                    <h2 class="q-text" id="qText"></h2>
                    <div class="q-visual" id="qVisual"></div>
                </div>
                <div class="options-grid" id="optionsGrid"></div>
            </div>
        </section>
    </div>

    <script>
        // ==================== CONFIG ====================
        const CONFIG = {
            pinchThreshold: 0.08,
            smoothingFactor: 0.3,
            soundEnabled: true,
            questionsPerRound: 10
        };

        // ==================== STATE ====================
        let currentTopic = 'vocabulary';
        let currentMode = 'learn';
        let currentLesson = 0;
        let currentQuestion = 0;
        let score = 0;
        let streak = 0;
        let lives = 3;
        let questions = [];
        let handPos = { x: 0, y: 0 };
        let isPinching = false;
        let wasPinching = false;
        let canAnswer = true;

        // ==================== AUDIO ====================
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioCtx();
        }

        function playTone(freq, dur = 0.2, type = 'sine') {
            if (!CONFIG.soundEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            osc.type = type;
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.start();
            osc.stop(audioCtx.currentTime + dur);
        }

        function playSuccess() {
            playTone(523, 0.1);
            setTimeout(() => playTone(659, 0.1), 100);
            setTimeout(() => playTone(784, 0.2), 200);
        }

        function playError() {
            playTone(200, 0.3, 'square');
        }

        function speak(text, rate = 0.9) {
            if (!CONFIG.soundEnabled) return;
            const u = new SpeechSynthesisUtterance(text);
            u.rate = rate;
            u.pitch = 1.1;
            speechSynthesis.speak(u);
        }

        function toggleSound() {
            CONFIG.soundEnabled = !CONFIG.soundEnabled;
            document.getElementById('soundToggle').textContent = CONFIG.soundEnabled ? 'üîä' : 'üîá';
        }

        // ==================== LESSON DATA ====================
        const lessons = {
            vocabulary: [
                { word: 'HAPPY', meaning: 'Feeling or showing pleasure', emoji: 'üòä', example: 'She was happy to see her friends.' },
                { word: 'BRAVE', meaning: 'Ready to face danger without fear', emoji: 'ü¶Å', example: 'The brave firefighter saved the cat.' },
                { word: 'CURIOUS', meaning: 'Wanting to learn or know things', emoji: 'üîç', example: 'The curious child asked many questions.' },
                { word: 'GENTLE', meaning: 'Soft, kind, and careful', emoji: 'üê∞', example: 'Be gentle with the baby bird.' },
                { word: 'ENORMOUS', meaning: 'Very big, huge', emoji: 'üêò', example: 'The elephant is enormous!' },
                { word: 'SWIFT', meaning: 'Moving very fast', emoji: '‚ö°', example: 'The swift rabbit ran across the field.' },
                { word: 'BEAUTIFUL', meaning: 'Very pretty or lovely', emoji: 'üå∫', example: 'The sunset was beautiful.' },
                { word: 'CLEVER', meaning: 'Smart and quick to understand', emoji: 'ü¶ä', example: 'The clever fox solved the puzzle.' }
            ],
            spelling: [
                { word: 'BECAUSE', tip: 'Big Elephants Can Always Understand Small Elephants', emoji: 'üêò' },
                { word: 'FRIEND', tip: 'I before E - FRI-END', emoji: 'ü§ù' },
                { word: 'SAID', tip: 'S-A-I-D, not like it sounds!', emoji: 'üí¨' },
                { word: 'THEY', tip: 'T-H-E-Y - The H is silent!', emoji: 'üë•' },
                { word: 'COULD', tip: 'O-U goes together, silent L', emoji: 'üí™' },
                { word: 'WOULD', tip: 'Same pattern as COULD', emoji: 'ü§î' },
                { word: 'THEIR', tip: 'T-H-E-I-R - belongings to them', emoji: 'üì¶' },
                { word: 'THERE', tip: 'T-H-E-R-E - a place (HERE is in THERE)', emoji: 'üìç' }
            ],
            grammar: [
                { title: 'Nouns - Naming Words', text: 'Nouns are words that name people, places, things, or ideas.', emoji: 'üì¶', examples: 'dog, school, book, love' },
                { title: 'Verbs - Action Words', text: 'Verbs are words that show action or state of being.', emoji: 'üèÉ', examples: 'run, jump, eat, is, are' },
                { title: 'Adjectives - Describing Words', text: 'Adjectives describe nouns. They tell us more about things.', emoji: 'üé®', examples: 'big, red, happy, soft' },
                { title: 'Pronouns - Replacement Words', text: 'Pronouns take the place of nouns to avoid repeating them.', emoji: 'üîÑ', examples: 'he, she, it, they, we' },
                { title: 'Adverbs - How, When, Where', text: 'Adverbs describe verbs. They tell how, when, or where.', emoji: '‚è∞', examples: 'quickly, yesterday, here' },
                { title: 'Sentences Need Two Parts', text: 'Every sentence needs a subject (who/what) and a predicate (what they do).', emoji: '‚úÇÔ∏è', examples: 'The cat (subject) sleeps (predicate).' }
            ],
            opposites: [
                { word: 'BIG', opposite: 'SMALL', emoji: '‚ÜîÔ∏è' },
                { word: 'HOT', opposite: 'COLD', emoji: 'üå°Ô∏è' },
                { word: 'HAPPY', opposite: 'SAD', emoji: 'üòäüò¢' },
                { word: 'FAST', opposite: 'SLOW', emoji: 'üèÉüê¢' },
                { word: 'UP', opposite: 'DOWN', emoji: '‚¨ÜÔ∏è‚¨áÔ∏è' },
                { word: 'LIGHT', opposite: 'DARK', emoji: '‚òÄÔ∏èüåô' },
                { word: 'OLD', opposite: 'NEW', emoji: 'üìúüì±' },
                { word: 'HARD', opposite: 'SOFT', emoji: 'ü™®üß∏' },
                { word: 'LOUD', opposite: 'QUIET', emoji: 'üì¢ü§´' },
                { word: 'FULL', opposite: 'EMPTY', emoji: 'ü•õü´ô' }
            ],
            rhymes: [
                { word: 'CAT', rhymes: ['BAT', 'HAT', 'MAT', 'RAT', 'SAT'], emoji: 'üê±' },
                { word: 'DOG', rhymes: ['FOG', 'LOG', 'HOG', 'JOG', 'BOG'], emoji: 'üêï' },
                { word: 'CAKE', rhymes: ['MAKE', 'LAKE', 'TAKE', 'BAKE', 'WAKE'], emoji: 'üéÇ' },
                { word: 'STAR', rhymes: ['CAR', 'FAR', 'JAR', 'BAR', 'TAR'], emoji: '‚≠ê' },
                { word: 'MOON', rhymes: ['SOON', 'SPOON', 'TUNE', 'JUNE', 'NOON'], emoji: 'üåô' },
                { word: 'RING', rhymes: ['SING', 'KING', 'WING', 'BRING', 'THING'], emoji: 'üíç' },
                { word: 'BOAT', rhymes: ['COAT', 'GOAT', 'FLOAT', 'NOTE', 'VOTE'], emoji: '‚õµ' },
                { word: 'TREE', rhymes: ['BEE', 'SEE', 'FREE', 'KEY', 'THREE'], emoji: 'üå≥' }
            ]
        };

        // ==================== QUESTION GENERATORS ====================
        function generateVocabularyQuestions() {
            const q = [];
            const words = [
                { word: 'HAPPY', meaning: 'Feeling joy', emoji: 'üòä' },
                { word: 'SAD', meaning: 'Feeling unhappy', emoji: 'üò¢' },
                { word: 'BRAVE', meaning: 'Not afraid', emoji: 'ü¶Å' },
                { word: 'CURIOUS', meaning: 'Wanting to know', emoji: 'üîç' },
                { word: 'GENTLE', meaning: 'Soft and kind', emoji: 'üê∞' },
                { word: 'ENORMOUS', meaning: 'Very big', emoji: 'üêò' },
                { word: 'TINY', meaning: 'Very small', emoji: 'üêú' },
                { word: 'SWIFT', meaning: 'Very fast', emoji: '‚ö°' },
                { word: 'ANGRY', meaning: 'Feeling mad', emoji: 'üò†' },
                { word: 'BEAUTIFUL', meaning: 'Very pretty', emoji: 'üå∫' },
                { word: 'CLEVER', meaning: 'Very smart', emoji: 'ü¶ä' },
                { word: 'SILLY', meaning: 'Funny and playful', emoji: 'ü§™' },
                { word: 'QUIET', meaning: 'Making no sound', emoji: 'ü§´' },
                { word: 'LOUD', meaning: 'Making big sounds', emoji: 'üì¢' },
                { word: 'HUNGRY', meaning: 'Wanting food', emoji: 'üçΩÔ∏è' }
            ];

            // What does this word mean?
            words.forEach(w => {
                const wrong = words.filter(x => x.word !== w.word).slice(0, 3);
                q.push({
                    question: `What does "${w.word}" mean?`,
                    visual: w.emoji,
                    answer: w.meaning,
                    options: shuffle([w.meaning, ...wrong.map(x => x.meaning)])
                });
            });

            // Which word matches this meaning?
            words.forEach(w => {
                const wrong = words.filter(x => x.word !== w.word).slice(0, 3);
                q.push({
                    question: `Which word means "${w.meaning}"?`,
                    visual: w.emoji,
                    answer: w.word,
                    options: shuffle([w.word, ...wrong.map(x => x.word)])
                });
            });

            return q;
        }

        function generateSpellingQuestions() {
            const q = [];
            const words = [
                { word: 'BECAUSE', missing: 'BEC_USE', answer: 'A' },
                { word: 'FRIEND', missing: 'FRI_ND', answer: 'E' },
                { word: 'SAID', missing: 'S_ID', answer: 'A' },
                { word: 'THEY', missing: 'TH_Y', answer: 'E' },
                { word: 'COULD', missing: 'CO_LD', answer: 'U' },
                { word: 'WOULD', missing: 'WO_LD', answer: 'U' },
                { word: 'THEIR', missing: 'TH_IR', answer: 'E' },
                { word: 'THERE', missing: 'TH_RE', answer: 'E' },
                { word: 'PEOPLE', missing: 'PE_PLE', answer: 'O' },
                { word: 'SCHOOL', missing: 'SCH_OL', answer: 'O' },
                { word: 'WRITE', missing: 'WR_TE', answer: 'I' },
                { word: 'KNOW', missing: 'KN_W', answer: 'O' },
                { word: 'WHICH', missing: 'WH_CH', answer: 'I' },
                { word: 'DOES', missing: 'DO_S', answer: 'E' },
                { word: 'HAVE', missing: 'H_VE', answer: 'A' }
            ];

            words.forEach(w => {
                const letters = ['A', 'E', 'I', 'O', 'U'];
                const wrong = letters.filter(l => l !== w.answer);
                q.push({
                    question: `Fill in the missing letter: ${w.missing}`,
                    visual: '‚úèÔ∏è',
                    answer: w.answer,
                    options: shuffle([w.answer, ...wrong.slice(0, 3)])
                });
            });

            // Which spelling is correct?
            const spellings = [
                { correct: 'FRIEND', wrong: ['FREIND', 'FREND', 'FRIND'] },
                { correct: 'BECAUSE', wrong: ['BECUZ', 'BECOUSE', 'BECASE'] },
                { correct: 'SAID', wrong: ['SED', 'SAYED', 'SAIED'] },
                { correct: 'PEOPLE', wrong: ['PEPLE', 'PEPOLE', 'PEEPLE'] },
                { correct: 'SCHOOL', wrong: ['SKOOL', 'SCOOL', 'SHOOL'] },
                { correct: 'WRITE', wrong: ['RITE', 'WRIT', 'WRIGT'] },
                { correct: 'DOES', wrong: ['DUZ', 'DOSE', 'DOEZ'] },
                { correct: 'WHICH', wrong: ['WICH', 'WHITCH', 'WITCH'] }
            ];

            spellings.forEach(s => {
                q.push({
                    question: 'Which spelling is CORRECT?',
                    visual: 'üìù',
                    answer: s.correct,
                    options: shuffle([s.correct, ...s.wrong.slice(0, 3)])
                });
            });

            return q;
        }

        function generateGrammarQuestions() {
            const q = [];

            // Identify parts of speech
            const nouns = ['dog', 'school', 'book', 'tree', 'car', 'house', 'ball', 'girl'];
            const verbs = ['run', 'jump', 'eat', 'sleep', 'read', 'play', 'sing', 'dance'];
            const adjectives = ['big', 'red', 'happy', 'soft', 'tall', 'fast', 'pretty', 'loud'];

            nouns.forEach(n => {
                q.push({
                    question: `What type of word is "${n}"?`,
                    visual: 'üì¶',
                    answer: 'Noun',
                    options: shuffle(['Noun', 'Verb', 'Adjective', 'Pronoun'])
                });
            });

            verbs.forEach(v => {
                q.push({
                    question: `What type of word is "${v}"?`,
                    visual: 'üèÉ',
                    answer: 'Verb',
                    options: shuffle(['Noun', 'Verb', 'Adjective', 'Adverb'])
                });
            });

            adjectives.forEach(a => {
                q.push({
                    question: `What type of word is "${a}"?`,
                    visual: 'üé®',
                    answer: 'Adjective',
                    options: shuffle(['Noun', 'Verb', 'Adjective', 'Pronoun'])
                });
            });

            // Pronoun questions
            const pronounQs = [
                { q: 'Which word can replace "Sarah"?', a: 'She', opts: ['She', 'He', 'They', 'It'] },
                { q: 'Which word can replace "the cat"?', a: 'It', opts: ['It', 'He', 'She', 'We'] },
                { q: 'Which word can replace "Tom"?', a: 'He', opts: ['He', 'She', 'It', 'They'] },
                { q: 'Which word can replace "the children"?', a: 'They', opts: ['They', 'We', 'It', 'She'] }
            ];

            pronounQs.forEach(pq => {
                q.push({
                    question: pq.q,
                    visual: 'üîÑ',
                    answer: pq.a,
                    options: shuffle([...pq.opts])
                });
            });

            return q;
        }

        function generateOppositesQuestions() {
            const q = [];
            const pairs = [
                ['BIG', 'SMALL'], ['HOT', 'COLD'], ['HAPPY', 'SAD'], ['FAST', 'SLOW'],
                ['UP', 'DOWN'], ['LIGHT', 'DARK'], ['OLD', 'NEW'], ['HARD', 'SOFT'],
                ['LOUD', 'QUIET'], ['FULL', 'EMPTY'], ['HIGH', 'LOW'], ['OPEN', 'CLOSED'],
                ['CLEAN', 'DIRTY'], ['WET', 'DRY'], ['HEAVY', 'LIGHT'], ['STRONG', 'WEAK'],
                ['YOUNG', 'OLD'], ['RICH', 'POOR'], ['THICK', 'THIN'], ['LONG', 'SHORT']
            ];

            pairs.forEach(([word, opposite]) => {
                const wrongAnswers = pairs.filter(p => p[0] !== word && p[1] !== opposite)
                    .map(p => Math.random() > 0.5 ? p[0] : p[1]).slice(0, 3);

                q.push({
                    question: `What is the opposite of "${word}"?`,
                    visual: '‚ÜîÔ∏è',
                    answer: opposite,
                    options: shuffle([opposite, ...wrongAnswers])
                });

                q.push({
                    question: `What is the opposite of "${opposite}"?`,
                    visual: '‚ÜîÔ∏è',
                    answer: word,
                    options: shuffle([word, ...wrongAnswers])
                });
            });

            return q;
        }

        function generateRhymesQuestions() {
            const q = [];
            const rhymeGroups = [
                { family: 'AT', words: ['CAT', 'BAT', 'HAT', 'MAT', 'RAT', 'SAT', 'FAT', 'PAT'] },
                { family: 'OG', words: ['DOG', 'FOG', 'LOG', 'HOG', 'JOG', 'BOG', 'FROG'] },
                { family: 'AKE', words: ['CAKE', 'MAKE', 'LAKE', 'TAKE', 'BAKE', 'WAKE', 'SNAKE'] },
                { family: 'AR', words: ['STAR', 'CAR', 'FAR', 'JAR', 'BAR'] },
                { family: 'OON', words: ['MOON', 'SOON', 'SPOON', 'NOON', 'BALLOON'] },
                { family: 'ING', words: ['RING', 'SING', 'KING', 'WING', 'BRING', 'THING', 'SPRING'] },
                { family: 'OAT', words: ['BOAT', 'COAT', 'GOAT', 'FLOAT'] },
                { family: 'EE', words: ['TREE', 'BEE', 'SEE', 'FREE', 'KEY', 'THREE'] },
                { family: 'ALL', words: ['BALL', 'CALL', 'FALL', 'TALL', 'WALL', 'SMALL'] },
                { family: 'UN', words: ['SUN', 'FUN', 'RUN', 'BUN', 'GUN'] }
            ];

            rhymeGroups.forEach(group => {
                for (let i = 0; i < group.words.length; i++) {
                    const word = group.words[i];
                    const rhymingWord = group.words[(i + 1) % group.words.length];

                    // Get non-rhyming words from other groups
                    const nonRhyming = rhymeGroups
                        .filter(g => g.family !== group.family)
                        .flatMap(g => g.words)
                        .slice(0, 10);

                    q.push({
                        question: `Which word rhymes with "${word}"?`,
                        visual: 'üéµ',
                        answer: rhymingWord,
                        options: shuffle([rhymingWord, ...shuffle(nonRhyming).slice(0, 3)])
                    });
                }
            });

            return q;
        }

        function shuffle(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        // ==================== GAME LOGIC ====================
        function selectTopic(topic) {
            currentTopic = topic;
            currentLesson = 0;

            document.querySelectorAll('.topic-card').forEach(c => {
                c.classList.remove('active');
                if (c.dataset.topic === topic) c.classList.add('active');
            });

            if (currentMode === 'learn') showLesson();
            else startQuiz();
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(t => {
                t.classList.remove('active');
                if (t.textContent.toLowerCase().includes(mode)) t.classList.add('active');
            });

            document.getElementById('learnContainer').classList.toggle('active', mode === 'learn');
            document.getElementById('quizContainer').classList.toggle('active', mode === 'quiz');

            if (mode === 'learn') {
                currentLesson = 0;
                showLesson();
            } else {
                startQuiz();
            }
        }

        function showLesson() {
            const data = lessons[currentTopic];
            if (!data || !data[currentLesson]) return;

            const lesson = data[currentLesson];
            let html = '';

            if (currentTopic === 'vocabulary') {
                html = `
                    <div class="learn-word">${lesson.word}</div>
                    <p class="learn-text">${lesson.emoji} ${lesson.meaning}</p>
                    <div class="example-box">
                        <p class="example-label">üìù Example:</p>
                        <p>"${lesson.example}"</p>
                    </div>
                `;
                speak(lesson.word + ' means ' + lesson.meaning);
            } else if (currentTopic === 'spelling') {
                html = `
                    <div class="learn-word">${lesson.word}</div>
                    <p class="learn-text">${lesson.emoji}</p>
                    <div class="example-box">
                        <p class="example-label">üí° Memory Tip:</p>
                        <p>${lesson.tip}</p>
                    </div>
                `;
                speak('The word is ' + lesson.word);
            } else if (currentTopic === 'grammar') {
                html = `
                    <h2 class="learn-title">${lesson.title}</h2>
                    <p class="learn-text">${lesson.emoji} ${lesson.text}</p>
                    <div class="example-box">
                        <p class="example-label">üìù Examples:</p>
                        <p>${lesson.examples}</p>
                    </div>
                `;
                speak(lesson.title + '. ' + lesson.text);
            } else if (currentTopic === 'opposites') {
                html = `
                    <div class="learn-word">${lesson.word} ‚ÜîÔ∏è ${lesson.opposite}</div>
                    <p class="learn-text">${lesson.emoji}</p>
                    <div class="example-box">
                        <p class="example-label">üí° Remember:</p>
                        <p>"${lesson.word}" is the opposite of "${lesson.opposite}"!</p>
                    </div>
                `;
                speak(lesson.word + ' is the opposite of ' + lesson.opposite);
            } else if (currentTopic === 'rhymes') {
                html = `
                    <div class="learn-word">${lesson.word}</div>
                    <p class="learn-text">${lesson.emoji} Words that rhyme:</p>
                    <div class="example-box">
                        <p style="font-size: 1.5rem; color: var(--accent-yellow);">${lesson.rhymes.join(', ')}</p>
                    </div>
                `;
                speak(lesson.word + ' rhymes with ' + lesson.rhymes.join(', '));
            }

            document.getElementById('learnCard').innerHTML = html;
        }

        function nextLesson() {
            initAudio();
            if (currentLesson < lessons[currentTopic].length - 1) {
                currentLesson++;
                showLesson();
            }
        }

        function prevLesson() {
            initAudio();
            if (currentLesson > 0) {
                currentLesson--;
                showLesson();
            }
        }

        function startQuiz() {
            score = 0;
            streak = 0;
            lives = 3;
            currentQuestion = 0;

            switch(currentTopic) {
                case 'vocabulary': questions = shuffle(generateVocabularyQuestions()).slice(0, CONFIG.questionsPerRound); break;
                case 'spelling': questions = shuffle(generateSpellingQuestions()).slice(0, CONFIG.questionsPerRound); break;
                case 'grammar': questions = shuffle(generateGrammarQuestions()).slice(0, CONFIG.questionsPerRound); break;
                case 'opposites': questions = shuffle(generateOppositesQuestions()).slice(0, CONFIG.questionsPerRound); break;
                case 'rhymes': questions = shuffle(generateRhymesQuestions()).slice(0, CONFIG.questionsPerRound); break;
            }

            updateStats();
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestion >= questions.length || lives <= 0) {
                showResults();
                return;
            }

            const q = questions[currentQuestion];
            document.getElementById('qNumber').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            document.getElementById('qText').textContent = q.question;
            document.getElementById('qVisual').textContent = q.visual;

            const grid = document.getElementById('optionsGrid');
            grid.innerHTML = '';

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                btn.dataset.answer = opt;
                grid.appendChild(btn);
            });

            updateProgress();
            canAnswer = true;
            speak(q.question);
        }

        function checkAnswer(selected, btn) {
            if (!canAnswer) return;
            canAnswer = false;
            initAudio();

            const q = questions[currentQuestion];
            const correct = selected === q.answer;

            if (correct) {
                btn.classList.add('correct');
                playSuccess();
                score += 10 + streak * 2;
                streak++;
                showFeedback('üéâ Correct!', 'success');
                speak('Great job!');
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.option-btn').forEach(b => {
                    if (b.dataset.answer === q.answer) b.classList.add('correct');
                });
                playError();
                streak = 0;
                lives--;
                showFeedback('‚ùå Try Again!', 'error');
                speak('The answer was ' + q.answer);
            }

            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 1500);
        }

        function showFeedback(msg, type) {
            const fb = document.getElementById('feedback');
            fb.textContent = msg;
            fb.className = 'feedback ' + type + ' show';
            setTimeout(() => fb.className = 'feedback', 1200);
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            document.getElementById('lives').textContent = lives;
        }

        function updateProgress() {
            const pct = (currentQuestion / questions.length) * 100;
            document.getElementById('progress').style.width = pct + '%';
        }

        function showResults() {
            const pct = (score / (questions.length * 10)) * 100;
            let stars = '‚≠ê';
            if (pct >= 70) stars = '‚≠ê‚≠ê';
            if (pct >= 90) stars = '‚≠ê‚≠ê‚≠ê';

            document.getElementById('resultsStars').textContent = stars;
            document.getElementById('resultsScore').textContent = `You scored ${score} points!`;
            document.getElementById('resultsModal').style.display = 'flex';

            playSuccess();
            speak('Fantastic! You scored ' + score + ' points!');
            createConfetti();
        }

        function restartQuiz() {
            document.getElementById('resultsModal').style.display = 'none';
            startQuiz();
        }

        function createConfetti() {
            const colors = ['#ff6b9d', '#c44dff', '#ffd93d', '#6bff8c', '#4dc3ff'];
            for (let i = 0; i < 50; i++) {
                const c = document.createElement('div');
                c.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}vw;
                    top: -10px;
                    border-radius: 50%;
                    animation: confettiFall ${2 + Math.random() * 2}s linear forwards;
                    z-index: 4000;
                `;
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 4000);
            }
        }

        // ==================== MEDIAPIPE ====================
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const handPointer = document.getElementById('handPointer');
        const camDot = document.getElementById('camDot');

        const hands = new Hands({
            locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    camDot.classList.add('on');
                    detect();
                };
            } catch (e) {
                console.error('Camera error:', e);
            }
        }

        async function detect() {
            if (video.readyState >= 2) await hands.send({ image: video });
            requestAnimationFrame(detect);
        }

        function onResults(results) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                drawConnectors(ctx, lm, HAND_CONNECTIONS, { color: '#ff6b9d', lineWidth: 2 });
                drawLandmarks(ctx, lm, { color: '#ffd93d', lineWidth: 1, radius: 3 });
                processHand(lm);
            } else {
                handPointer.style.display = 'none';
            }
        }

        function processHand(lm) {
            const indexTip = lm[8];
            const thumbTip = lm[4];

            const rawX = (1 - indexTip.x) * window.innerWidth;
            const rawY = indexTip.y * window.innerHeight;

            handPos.x += (rawX - handPos.x) * CONFIG.smoothingFactor;
            handPos.y += (rawY - handPos.y) * CONFIG.smoothingFactor;

            handPointer.style.display = 'block';
            handPointer.style.left = (handPos.x - 25) + 'px';
            handPointer.style.top = (handPos.y - 25) + 'px';

            const dist = Math.sqrt(
                Math.pow(indexTip.x - thumbTip.x, 2) +
                Math.pow(indexTip.y - thumbTip.y, 2) +
                Math.pow(indexTip.z - thumbTip.z, 2)
            );

            isPinching = dist < CONFIG.pinchThreshold;
            handPointer.className = 'hand-pointer ' + (isPinching ? 'closed' : 'open');

            if (isPinching && !wasPinching) {
                const els = document.elementsFromPoint(handPos.x, handPos.y);
                for (const el of els) {
                    if (el.classList.contains('option-btn') && canAnswer) { el.click(); break; }
                    if (el.classList.contains('topic-card')) { el.click(); break; }
                    if (el.classList.contains('mode-tab')) { el.click(); break; }
                    if (el.classList.contains('nav-btn')) { el.click(); break; }
                    if (el.classList.contains('letter-btn')) { el.click(); break; }
                }
            }

            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('highlight'));
            const hovered = document.elementsFromPoint(handPos.x, handPos.y);
            for (const el of hovered) {
                if (el.classList.contains('option-btn')) { el.classList.add('highlight'); break; }
            }

            wasPinching = isPinching;
        }

        const HAND_CONNECTIONS = [
            [0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],
            [0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],
            [0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]
        ];

        // ==================== BACKGROUND ====================
        function createFloatingLetters() {
            const container = document.getElementById('bookBg');
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            const colors = ['#ff6b9d', '#c44dff', '#ffd93d', '#6bff8c', '#4dc3ff'];

            for (let i = 0; i < 20; i++) {
                const letter = document.createElement('div');
                letter.className = 'floating-letter';
                letter.textContent = letters[Math.floor(Math.random() * letters.length)];
                letter.style.left = Math.random() * 100 + 'vw';
                letter.style.top = Math.random() * 100 + 'vh';
                letter.style.color = colors[Math.floor(Math.random() * colors.length)];
                letter.style.animationDelay = Math.random() * 20 + 's';
                container.appendChild(letter);
            }
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            createFloatingLetters();
            setupCamera();
            showLesson();
        });

        const style = document.createElement('style');
        style.textContent = `
            @keyframes confettiFall {
                0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>